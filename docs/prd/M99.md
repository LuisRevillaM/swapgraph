# M99 — Trust & safety risk-signal contracts (implementation-ready, implemented fixtures-first)

Status: implemented (fixtures-first) on 2026-02-21.

## Objective
Formalize v2 trust/safety iteration as deterministic contract surfaces for fraud and account-takeover detection, policy decisions, and auditable exports.

## Scope
### A) Risk-signal ingestion contracts (to define)
1. `trustSafety.signal.record` → `POST /trust-safety/signals`
   - deterministic ingestion of partner/user-linked trust/safety signals
   - signal categories include fraud and account-takeover indicators

### B) Policy decision contracts (to define)
1. `trustSafety.decision.record` → `POST /trust-safety/decisions`
   - idempotent decision write with deterministic outcomes: `allow`, `manual_review`, `block`
2. `trustSafety.decision.get` → `GET /trust-safety/decisions/{decision_id}`
   - canonical read projection for policy decisions and reason-code lineage

### C) Audit/export contracts (to define)
1. `trustSafety.decision.export` → `GET /trust-safety/decisions/export`
   - signed export of trust/safety decision history
   - deterministic continuation + tamper-fail verification

## Proposed contract map (for approval)

### Signal categories (minimum)
- `fraud_value_anomaly`
- `fraud_velocity_spike`
- `fraud_cycle_abuse_pattern`
- `ato_device_drift`
- `ato_session_geo_impossible`
- `ato_credential_reuse_suspected`

### Decision outputs
- `allow`
- `manual_review`
- `block`

### Decision payload minimum fields
- `decision_id`
- `subject_actor_type`
- `subject_actor_id`
- `decision`
- `reason_codes[]`
- `contributing_signal_ids[]`
- `severity`
- `confidence_score_bps`
- `recorded_at`
- `correlation_id`

## Contract constraints
- Idempotency required for signal and decision writes.
- Stable reason-code taxonomy (no free-form decision semantics).
- Safety decisions cannot be bypassed by commercial policy layers.
- Cross-link hooks required for downstream dispute and reliability workflows.

## Proposed schema artifacts (naming target)
- `TrustSafetySignalRecordRequest.schema.json`
- `TrustSafetySignalRecordResponse.schema.json`
- `TrustSafetyDecisionRecordRequest.schema.json`
- `TrustSafetyDecisionRecordResponse.schema.json`
- `TrustSafetyDecisionGetResponse.schema.json`
- `TrustSafetyDecisionExportResponse.schema.json`

## Deterministic reason-code floor (proposed)
- `trust_safety_signal_invalid`
- `trust_safety_signal_invalid_timestamp`
- `trust_safety_signal_subject_missing`
- `trust_safety_decision_invalid`
- `trust_safety_decision_invalid_timestamp`
- `trust_safety_decision_subject_mismatch`
- `trust_safety_decision_not_found`
- `trust_safety_export_query_invalid`
- `trust_safety_export_cursor_not_found`

## PRD review closure matrix
| Decision | Proposal | Status |
|---|---|---|
| Scope model | Reuse existing scope family (`settlement:read/write`) for initial implementation tranche to avoid auth-validator churn | Pending approval |
| Signal taxonomy floor | Use six minimum categories listed above; additions must be backward-compatible | Pending approval |
| Decision semantics | Deterministic output set restricted to `allow/manual_review/block` | Pending approval |
| Retention/redaction | Export must support retention-bound filtering and subject redaction policy hooks | Pending approval |
| Dispute/reliability links | Decision records include optional refs to dispute ids and reliability artifacts | Pending approval |
| Export integrity | Signed export with attestation continuity required | Pending approval |

## Non-goals (M99)
- No model-training or heuristic tuning implementation.
- No production fraud model rollout.
- No manual-review tooling UI implementation.

## Acceptance (PRD stage)
- M99 PRD is accepted when:
  1. operation inventory is complete,
  2. signal taxonomy and decision reason-code floor are approved,
  3. export integrity boundaries are explicit,
  4. retention/redaction and cross-link semantics are resolved.

## Acceptance (future implementation stage)
- `npm run verify:m99` exits 0.
- `node verify/runner.mjs milestones/M99.yaml` returns `overall=true`.
- Artifacts under `artifacts/milestones/M99/latest/*`.
