# M61 — Rollout diagnostics export + operator runbook hooks (fixtures-first)

## Objective
Provide a deterministic, signed control-plane diagnostics export for partner-program rollout governance so operators can quickly assess active gates and apply known-safe remediation actions.

## Scope

### 1) Diagnostics export surface
Add admin-only endpoint:
- `GET /partner-program/vault-export/rollout-policy/diagnostics/export`
- operation: `partnerProgram.vault_export.rollout_policy.diagnostics.export`

Response includes:
- effective rollout policy view,
- operator overlay/env state,
- deterministic recommended actions,
- runbook hook templates,
- signed `export_hash` + detached signature for offline verification.

### 2) Deterministic recommendations
Diagnostics computes action recommendations from active controls:
- maintenance mode active → `clear_maintenance_mode`
- freeze window active → `clear_freeze_window`
- no active control gates → `none`

### 3) Runbook hooks
Diagnostics includes canonical runbook hook templates for:
- disabling maintenance mode,
- clearing freeze window,
- clearing controls,
- observe-only diagnostics polling.

### 4) Signed diagnostics integrity
Add signing/verification helpers for diagnostics export payloads with tamper-fail behavior.

### 5) Contract artifacts
Update:
- API manifest endpoint entry,
- diagnostics export response schema,
- API example manifest + diagnostics example,
- API docs for diagnostics endpoint.

### 6) Fixtures-first verifier
Scenario proves:
- non-admin diagnostics export rejection,
- admin diagnostics export success (active controls) with deterministic recommendation/hook projections,
- diagnostics signature verification + tamper-fail check,
- control clear path yields `none` recommendation,
- settlement export behavior remains consistent before/after control clear.

## Acceptance criteria
- `npm run verify:m61` exits 0.
- `node verify/runner.mjs milestones/M61.yaml` returns `overall=true`.
- artifacts exist under `artifacts/milestones/M61/latest/*`.
