# M6 — Proposal delivery (polling + webhooks) fixtures-first

## Objective
Make “proposal delivery” a deterministic, verifiable contract:
- proposals can be consumed via **polling** (`GET /cycle-proposals` response shape), and
- the same proposals can be delivered via **webhook events** using the M3 event envelope + payload schemas.

This milestone proves that partners can rely on:
- stable payload shapes,
- at-least-once webhook delivery (duplicate `event_id` possible),
- dedupe-by-`event_id` requirements.

## Scope
- Delivery builder that:
  - takes CycleProposals (from fixtures),
  - produces polling payload `{ proposals: [...] }`,
  - produces webhook events `proposal.created` (and optionally `proposal.expiring`),
  - uses deterministic ids/correlation ids.
- Fixture runner that validates:
  - polling payload against `CycleProposalListResponse.schema.json`
  - webhook envelopes against `EventEnvelope.schema.json`
  - webhook payloads against per-event payload schemas (events manifest)
  - output matches expected snapshot.

## Non-goals
- No actual HTTP server.
- No outbound webhook network delivery.
- No webhook signing yet.

## Acceptance criteria
- `npm run verify:m6` exits 0.
- `node verify/runner.ts milestones/M6.yaml` exits 0.

## Required artifacts
Fixtures:
- `fixtures/delivery/m6_input.json`
- `fixtures/delivery/m6_expected.json`

Proof artifacts:
- `artifacts/milestones/M6/latest/polling_response.json`
- `artifacts/milestones/M6/latest/webhook_events.ndjson`
- `artifacts/milestones/M6/latest/delivery_output.json`
- `artifacts/milestones/M6/latest/delivery_validation.json`
- `artifacts/milestones/M6/latest/assertions.json`
- `artifacts/milestones/M6/latest/commands.log`
