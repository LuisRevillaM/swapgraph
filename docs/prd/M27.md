# M27 â€” Correlation IDs in ErrorResponse (fixtures-first)

## Objective
Enforce the platform contract principle that **every response** includes a correlation ID.

In production this is an `X-Correlation-Id` response header.
Because SwapGraph is still **fixtures-first** (no HTTP layer yet), we model that header as a required top-level JSON field:
- `correlation_id` on **success** bodies (already done in M17/M25/M26)
- `correlation_id` on **error** bodies (this milestone)

## Scope
### 1) Schema
Update `docs/spec/schemas/ErrorResponse.schema.json` to require:
- `correlation_id` (string, minLength 1)
- `error` (existing envelope)

### 2) Examples
Update `docs/spec/examples/api/error.example.json` to include `correlation_id`.

### 3) Implementation
Propagate `correlation_id` into all fixtures-first error envelopes returned by:
- `src/service/swapIntentsService.mjs`
- `src/read/cycleProposalsReadService.mjs`
- `src/commit/commitService.mjs`
- `src/service/cycleProposalsCommitService.mjs`
- `src/read/settlementReadService.mjs`
- `src/service/settlementWriteApiService.mjs`

Also update any fixture scenario helpers that emit `ErrorResponse` bodies directly.

### 4) Docs
Update the API contract note in `docs/spec/API.md` and the error contract in `docs/spec/ERRORS.md` to reflect the new shape.

## Correlation ID rules (fixtures-first)
Deterministic rules (stand-ins for request/response headers):
- cycle-scoped endpoints: `corr_<cycle_id>`
- intent endpoints: `corr_<intent_id>`
- commit lookup not-found: `corr_<commit_id>`
- list endpoints: stable per-actor strings (as already implemented)

## Acceptance criteria
- `npm run verify:m27` exits 0.
- `node verify/runner.ts milestones/M27.yaml` exits 0.

## Required artifacts
- `docs/prd/M27.md`
- updated `ErrorResponse` schema + example
- updated implementations (see Scope)
- proof artifacts under `artifacts/milestones/M27/latest/*`
