# M9 — Settlement timeline simulator (deposit → execute → receipt)

## Objective
Implement a **fixtures-first settlement state machine** that proves:
- `SettlementTimeline` transitions are deterministic and auditable.
- deposits are tracked per-leg.
- execution completion produces a `SwapReceipt`.
- deposit timeout unwinds/refunds and produces a failure receipt.
- terminal states release intent reservations.

This is a simulator milestone: no Steam adapter, no escrow accounts — just deterministic rules + proof artifacts.

## Scope
- SettlementTimeline lifecycle:
  - `accepted → escrow.pending → escrow.ready → executing → completed`
  - timeout path: `escrow.pending → failed` with reason code
- Per-leg statuses:
  - `pending → deposited → released` (success)
  - `pending/deposited → refunded` (failure unwind)
- Emit events using existing M3 envelope + payload schemas:
  - `cycle.state_changed`
  - `intent.unreserved`
  - `receipt.created`

## Non-goals
- No real custody / trade-offer integration.
- No cryptographic signing implementation beyond placeholder signature fields.

## Acceptance criteria
- `npm run verify:m9` exits 0.
- `node verify/runner.mjs milestones/M9.yaml` exits 0.
- Proof artifacts committed under `artifacts/milestones/M9/latest/*`.

## Required artifacts
Fixtures:
- `fixtures/settlement/m9_scenario.json`
- `fixtures/settlement/m9_expected.json`

Proof artifacts:
- `artifacts/milestones/M9/latest/settlement_output.json`
- `artifacts/milestones/M9/latest/events_outbox.ndjson`
- `artifacts/milestones/M9/latest/events_validation.json`
- `artifacts/milestones/M9/latest/assertions.json`
- `artifacts/milestones/M9/latest/commands.log`
