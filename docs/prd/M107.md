# M107 — Operator-assisted settlement and Steam-safe execution controls (implemented, fixtures-first)

Status: Implemented and verifier-closed on 2026-02-22 (`INTEGRATION_ENABLED=1 npm run verify:m107`, `node verify/runner.mjs milestones/M107.yaml`).

## Objective
Define LP execution-mode and operator-approval contracts that enforce a safe default (`operator_assisted`) and deterministic hard-stop behavior for platform-restricted execution paths.

## Why this is required (integration findings)
- Existing live-proof milestones already use integration-gated operator workflows.
- Steam-first execution risk requires conservative automation posture.
- LP subsystem must encode execution governance as contracts, not tribal runbook behavior.

## Scope
### A) Execution mode contracts (implemented)
1. `liquidityExecution.mode.upsert` → `POST /liquidity-providers/{provider_id}/execution-mode`
2. `liquidityExecution.mode.get` → `GET /liquidity-providers/{provider_id}/execution-mode`

### B) Operator-approval contracts (implemented)
1. `liquidityExecution.request.record` → `POST /liquidity-providers/{provider_id}/execution-requests`
2. `liquidityExecution.request.approve` → `POST /liquidity-providers/{provider_id}/execution-requests/{request_id}/approve`
3. `liquidityExecution.request.reject` → `POST /liquidity-providers/{provider_id}/execution-requests/{request_id}/reject`
4. `liquidityExecution.export` → `GET /liquidity-providers/{provider_id}/execution-requests/export`

### C) Safety constraints (enforced)
- `operator_assisted` is the default effective execution mode for restricted adapter contexts.
- `constrained_auto` in restricted contexts requires explicit override policy records and an enabled integration gate (`INTEGRATION_ENABLED=1`).
- High-risk/platform-blocked request paths fail deterministically with explicit reason codes.
- Operator approve/reject records require explicit `operator_actor`, decision reason codes, and correlation lineage.
- Execution exports are signed and checkpoint/attestation continuity-verifiable.

## Implemented schema artifacts
- `LiquidityExecutionOverridePolicy.schema.json`
- `LiquidityExecutionModeView.schema.json`
- `LiquidityExecutionRequestView.schema.json`
- `LiquidityExecutionModeUpsertRequest.schema.json`
- `LiquidityExecutionModeUpsertResponse.schema.json`
- `LiquidityExecutionModeGetResponse.schema.json`
- `LiquidityExecutionRequestRecordRequest.schema.json`
- `LiquidityExecutionRequestRecordResponse.schema.json`
- `LiquidityExecutionRequestApproveRequest.schema.json`
- `LiquidityExecutionRequestApproveResponse.schema.json`
- `LiquidityExecutionRequestRejectRequest.schema.json`
- `LiquidityExecutionRequestRejectResponse.schema.json`
- `LiquidityExecutionRequestExportResponse.schema.json`

## Event additions (implemented)
- `liquidity.execution_mode.updated`
- `liquidity.execution_request.recorded`
- `liquidity.execution_request.decided`

## Deterministic reason-code floor (enforced)
- `liquidity_execution_mode_invalid`
- `liquidity_execution_mode_restricted`
- `liquidity_execution_request_invalid`
- `liquidity_execution_request_not_found`
- `liquidity_execution_operator_approval_required`
- `liquidity_execution_platform_policy_blocked`

## Non-goals (M107)
- No legal interpretation automation.
- No unrestricted full-automation rollout.
- No UI implementation for operator consoles.

## Acceptance (implementation stage)
- `INTEGRATION_ENABLED=1 npm run verify:m107` exits 0.
- `node verify/runner.mjs milestones/M107.yaml` returns `overall=true`.
- Artifacts under `artifacts/milestones/M107/latest/*`.
