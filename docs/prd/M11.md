# M11 — Settlement event types (deposit required/confirmed/executing)

## Objective
Align the event contract with the v2.0 plan’s settlement integration model by adding settlement-specific event types that are:
- **append-only** (outbox)
- **schema-validated**
- **replay-safe** (at-least-once + de-dupe by `event_id`)

## Scope
### New event types
Add these event types to `docs/spec/events/manifest.v1.json`:
- `settlement.deposit_required`
- `settlement.deposit_confirmed`
- `settlement.executing`

Add payload schemas:
- `SettlementDepositRequiredPayload.schema.json`
- `SettlementDepositConfirmedPayload.schema.json`
- `SettlementExecutingPayload.schema.json`

### Emission rules (fixtures-first)
Update the settlement simulator (M9) to emit:
- `settlement.deposit_required` when settlement starts (`accepted → escrow.pending`)
- `settlement.deposit_confirmed` when a participant’s deposit is confirmed (per intent/leg)
- `settlement.executing` when execution begins (`escrow.ready → executing`)

These events are **additive** to `cycle.state_changed`.

### Verification
A fixtures-first scenario proves:
- event payloads validate against the manifest
- idempotent replays do not emit duplicate settlement events

## Acceptance criteria
- `npm run verify:m11` exits 0.
- `node verify/runner.ts milestones/M11.yaml` exits 0.

## Required artifacts
Fixtures:
- `fixtures/settlement/m11_scenario.json`
- `fixtures/settlement/m11_expected.json`

Proof artifacts:
- `artifacts/milestones/M11/latest/settlement_events_output.json`
- `artifacts/milestones/M11/latest/events_outbox.ndjson`
- `artifacts/milestones/M11/latest/events_validation.json`
- `artifacts/milestones/M11/latest/assertions.json`
- `artifacts/milestones/M11/latest/commands.log`
