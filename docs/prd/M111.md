# M111 â€” Marketplace execution loop contracts (implemented, fixtures-first)

Status: Implemented and verifier-closed on 2026-02-22 (`npm run verify:m111`, `node verify/runner.mjs milestones/M111.yaml`).

## Objective
Activate a marketplace-first matching execution loop so product surfaces can drive real proposal generation from stored user intents instead of fixture-only seeded proposals.

## Scope
### A) Matching execution contracts
1. `marketplaceMatching.run` -> `POST /marketplace/matching/runs`
   - idempotent matching run request with optional asset-value overrides.
   - deterministic proposal replacement semantics for marketplace-sourced proposals.
   - deterministic expired-proposal garbage collection before run.

2. `marketplaceMatchingRun.get` -> `GET /marketplace/matching/runs/{run_id}`
   - deterministic run-record projection with stored run stats and generated proposal references.

### B) Runtime integration
- Runtime server wires matching-run and run-read endpoints.
- Health summary includes marketplace matching run/proposal counters.
- Generated proposals are persisted into canonical proposal store and immediately visible to read/product projection surfaces.

### C) Deterministic run records
- Every successful run produces:
  - run identity (`run_id`)
  - request actor + timestamp
  - run stats (`intents_active`, `edges`, `candidate_cycles`, `candidate_proposals`, `selected_proposals`)
  - proposal references and lifecycle counts (`stored`, `replaced`, `expired`)

## Deterministic reason-code floor
- `marketplace_matching_invalid_request`
- `marketplace_matching_asset_values_missing`
- `marketplace_matching_run_not_found`

## Non-goals (M111)
- No client UI implementation in this milestone.
- No change to core matching heuristic (2-3 cycle search + deterministic greedy disjoint pick).
- No SQLite migration in this milestone.

## Acceptance
M111 is accepted when:
1. marketplace matching run/get contracts are explicit and implemented,
2. run lifecycle semantics (expired/replaced/stored counts) are deterministic and verifier-covered,
3. API manifest/auth/schema/example contracts include the new operations,
4. deterministic reason-code floor is enforced and verified.

## Implementation closure gate (M111)
M111 implementation closure is achieved when:
- `npm run verify:m111` exits 0.
- `node verify/runner.mjs milestones/M111.yaml` returns `overall=true`.
- Artifacts are present under `artifacts/milestones/M111/latest/*`.
