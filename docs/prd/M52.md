# M52 â€” Partner vault/settlement reconciliation export surface (fixtures-first)

## Objective
Add a signed partner export endpoint for vault-backed settlement reconciliation snapshots so partners can store and verify immutable reconciliation artifacts offline.

## Scope

### 1) New export endpoint contract
Add partner read endpoint:
- `GET /settlement/{cycle_id}/vault-reconciliation/export`

Response includes:
- `exported_at`
- `query` (`cycle_id`, `include_transitions`, optional deterministic timestamp fields)
- `cycle_id`, `timeline_state`
- `vault_reconciliation`
- optional `state_transitions`
- `export_hash`
- detached `signature` (policy-integrity key)

### 2) Service implementation
In `SettlementReadService`:
- authorize via manifest operation id `settlement.vault_reconciliation.export`
- partner-only read enforcement
- deterministic include/exclude for state transitions (`include_transitions`)
- deterministic validation for malformed include flag
- deterministic error for non-vault cycles (`vault_reconciliation_not_available`)

### 3) Signing + verification primitives
Extend policy-integrity signing helpers with vault reconciliation export hash/sign/verify functions.

### 4) Fixtures-first verifier
Scenario proves:
- export works for full-vault ready/completed states and partial-vault failed states,
- exported payload verifies against both built-in key registry and published public key,
- tampered export fails verification (`hash_mismatch`),
- non-partner export is forbidden,
- invalid `include_transitions` query flag fails deterministically.

## Acceptance criteria
- `npm run verify:m52` exits 0.
- `node verify/runner.ts milestones/M52.yaml` returns `overall=true`.
- artifacts exist under `artifacts/milestones/M52/latest/*`.
