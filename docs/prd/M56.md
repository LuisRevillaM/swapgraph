# M56 â€” Partner-program governance read surface + rollout policy hooks (fixtures-first)

## Objective
Add deterministic governance controls around vault reconciliation export rollout:
1) partner self-serve visibility into entitlement/quota/policy state, and
2) policy hooks for staged rollout by allowlist + minimum plan.

## Scope

### 1) Governance read API (partner self-serve)
Introduce `GET /partner-program/vault-export` (`partnerProgram.vault_export.get`) returning:
- current partner program enrollment/plan,
- vault export feature entitlement,
- daily quota limit + used count for the evaluated day,
- rollout-policy metadata (program enforcement, allowlist status, min-plan requirement, checkpoint settings),
- deterministic `export_allowed` + `reasons[]` summary.

### 2) Rollout policy hooks on export path
Extend `settlement.vault_reconciliation.export` partner-program enforcement with:
- allowlist gate from `SETTLEMENT_VAULT_EXPORT_PARTNER_ALLOWLIST` (comma-separated partner ids),
- minimum plan gate from `SETTLEMENT_VAULT_EXPORT_MIN_PLAN` (`starter|pro|enterprise`).

Deterministic failure reason codes:
- `partner_rollout_not_allowed`
- `partner_plan_insufficient`
- `partner_rollout_config_invalid` (invalid rollout config)

Existing partner-program controls remain active:
- `partner_program_missing`
- `partner_feature_not_enabled`
- `partner_quota_exceeded`

### 3) Contract updates
- API manifest includes new operation and auth contract.
- New schema: `PartnerProgramVaultExportGetResponse.schema.json`.
- API examples manifest includes partner governance example.

### 4) Fixtures-first verifier
Scenario proves deterministic progression:
- starter plan blocked by min-plan requirement,
- partner blocked when removed from allowlist,
- same partner allowed after allowlist + plan upgrade,
- successful export increments usage and remains cryptographically verifiable,
- non-partner actor denied governance endpoint.

## Acceptance criteria
- `npm run verify:m56` exits 0.
- `node verify/runner.mjs milestones/M56.yaml` returns `overall=true`.
- artifacts exist under `artifacts/milestones/M56/latest/*`.
