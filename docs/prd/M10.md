# M10 — Settlement + receipts REST contract (and strict timeline legs schema)

## Objective
Turn M9’s settlement simulator into a **first-class contract** by:
1) tightening `SettlementTimeline` so legs are **schema-validated**, and
2) adding REST endpoints for **settlement status/instructions** and **receipts**.

This milestone is contract-first (fixtures + schemas). It does not add any real custody / Steam integration.

## Scope
### 1) Strict SettlementTimeline legs schema
Update `SettlementTimeline.schema.json` so `legs[]` has a concrete, validated structure:
- `leg_id`, `intent_id`
- `from_actor`, `to_actor`
- `assets[]`
- `status`: `pending|deposited|released|refunded`
- `deposit_deadline_at` + optional refs/timestamps (`deposit_ref`, `released_at`, etc.)

### 2) REST API surface additions
Add illustrative v1 endpoints to the API manifest:
- `GET /settlement/{cycle_id}/instructions`
- `GET /settlement/{cycle_id}/status`
- `GET /receipts/{cycle_id}`

Add schemas + examples for the responses.

## Non-goals
- No settlement mutation endpoints yet (deposit confirmation, execution) — those are internal adapter/worker actions in the real system.
- No new webhook event types in v1 (we continue to use `cycle.state_changed` + `receipt.created`).

## Acceptance criteria
- `npm run verify:m10` exits 0.
- `node verify/runner.mjs milestones/M10.yaml` exits 0.
- `npm run verify:m1` and `npm run verify:m2` remain green (schema + API contract still validate).

## Required artifacts
- Updated schema + example:
  - `docs/spec/schemas/SettlementTimeline.schema.json`
  - `docs/spec/examples/SettlementTimeline.example.json`
- Updated API contract:
  - `docs/spec/API.md`
  - `docs/spec/api/manifest.v1.json`
  - `docs/spec/examples/api/_manifest.v1.json`
  - `docs/spec/examples/api/settlement.instructions.response.json`
  - `docs/spec/examples/api/settlement.status.response.json`
  - `docs/spec/examples/api/receipts.get.response.json`
