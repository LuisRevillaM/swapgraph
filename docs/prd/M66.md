# M66 â€” Rollout diagnostics automation plan-hash integrity anchors (fixtures-first)

## Objective
Strengthen signed automation guidance integrity by adding deterministic per-request hashes and a bundle-level plan hash to diagnostics automation hints.

## Scope

### 1) Per-request integrity anchor
Extend `automation_hints.action_requests[]` with:
- `request_hash` (sha256 over deterministic request template payload)

### 2) Bundle-level integrity anchor
Extend `automation_hints` with:
- `plan_hash` (sha256 over deterministic automation plan components)

### 3) Signing/hash normalization coverage
Ensure `request_hash` and `plan_hash` are included in diagnostics export normalization and hash/signature verification paths.

### 4) Contract/docs updates
Update schema/examples/API docs for:
- `automation_hints.action_requests[].request_hash`
- `automation_hints.plan_hash`

### 5) Fixtures-first verifier
Scenario proves:
- request-hash and plan-hash are present for action-bearing plans (`automation_max_actions=1` and `2`)
- continuation exports preserve deterministic hash anchors
- empty action plans after `clear_controls` still include `plan_hash`
- existing guardrails remain deterministic (`automation_requires_runbook_hooks`, `automation_invalid`)
- tamper-fail verification continues to hold

## Acceptance criteria
- `npm run verify:m66` exits 0.
- `node verify/runner.ts milestones/M66.yaml` returns `overall=true`.
- artifacts exist under `artifacts/milestones/M66/latest/*`.
