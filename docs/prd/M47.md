# M47 â€” Vault deposit/withdraw lifecycle contract scaffold (fixtures-first)

## Objective
Define and prove deterministic vault holding lifecycle transitions for the custody track.

## Scope

### 1) Vault lifecycle service scaffold
Add a fixtures-first vault lifecycle service covering:
- `deposit` (user-owned holding enters vault as `available`)
- `reserve` (partner marks holding `reserved` for settlement)
- `release` (partner clears reservation back to `available`)
- `withdraw` (owner withdraws available holding to `withdrawn`)
- read helpers (`get`, `list`)

### 2) Deterministic state rules
Enforce clear transition constraints:
- withdraw is blocked while reserved,
- release requires matching `reservation_id`,
- owner mismatch is forbidden for withdraw/get,
- reserved/withdrawn holdings are not reservable.

Idempotency behavior for mutations is deterministic and reuses global idempotency state.

### 3) Vault schemas/examples
Add spec primitives for vault state evidence:
- `VaultHolding`
- `VaultEvent`

### 4) Fixtures-first verifier
Scenario proves:
- deposit replay behavior,
- reserve/release/withdraw happy path,
- forbidden + constraint violations with reason codes,
- list filtering (`include_withdrawn`) behavior,
- idempotency payload mismatch detection.

## Acceptance criteria
- `npm run verify:m47` exits 0.
- `node verify/runner.ts milestones/M47.yaml` returns `overall=true`.
- artifacts exist under `artifacts/milestones/M47/latest/*`.
