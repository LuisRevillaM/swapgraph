# M59 â€” Rollout governance controls hardening (freeze windows + maintenance-mode + admin-action overlays) (fixtures-first)

## Objective
Add deterministic governance overlays for partner-program rollout policy:
- policy freeze windows,
- maintenance-mode export gates,
- explicit admin-action mutation surface,
- signed audit coverage including admin actions.

## Scope

### 1) Rollout policy controls model
Extend rollout policy view/state with controls:
- `maintenance_mode_enabled`
- `maintenance_reason_code`
- `freeze_until`
- `freeze_reason_code`
- computed `freeze_active`
- admin action metadata (`last_admin_action_at`, `last_admin_action_by`)

### 2) Admin action mutation API
Introduce idempotent admin control endpoint:
- `POST /partner-program/vault-export/rollout-policy/admin-action`
- operation: `partnerProgram.vault_export.rollout_policy.admin_action`

Actions:
- `set_maintenance_mode`
- `set_freeze_window`
- `clear_controls`

All actions emit deterministic rollout policy audit entries with `operation_id=...admin_action` and `admin_action` payload.

### 3) Freeze-window mutation gate
For rollout policy upserts:
- if freeze window is active at mutation time, reject with
  - `CONSTRAINT_VIOLATION`
  - `reason_code=partner_rollout_frozen`

### 4) Maintenance-mode export gate
For settlement vault reconciliation exports (under partner-program enforcement):
- if maintenance mode is active, reject with
  - `FORBIDDEN`
  - `reason_code=partner_rollout_maintenance_mode`

Partner governance read surface exposes maintenance/freeze control state and includes maintenance reason in reasons list when active.

### 5) Signed-audit compatibility updates
- Rollout policy view schema now includes controls.
- Rollout policy audit entry schema supports admin-action records and expanded change summary fields.
- Rollout policy audit export schema/examples include controls + compatibility with attestation/checkpoint continuity contract.

### 6) Fixtures-first verifier
Scenario proves:
- baseline export success,
- non-admin admin-action rejection,
- maintenance mode blocks settlement exports deterministically,
- freeze window marks policy frozen and blocks upsert mutations,
- clear-controls action restores export path,
- signed settlement export verify/tamper checks,
- signed rollout-policy audit export pagination continuity + verify/tamper checks,
- admin actions appear in audit timeline.

## Acceptance criteria
- `npm run verify:m59` exits 0.
- `node verify/runner.ts milestones/M59.yaml` returns `overall=true`.
- artifacts exist under `artifacts/milestones/M59/latest/*`.
