# M12 â€” Event replay v2 (settlement + checkpoint demo)

## Objective
Extend the event replay proof so it covers **settlement + receipts** and demonstrates **checkpoint resume**.

We want to prove that:
- the event stream is **schema-valid** against `docs/spec/events/manifest.v1.json`
- consumers can **de-dupe** at-least-once deliveries by `event_id`
- a consumer can resume from a checkpoint `{ last_event_id }` by applying subsequent events to its persisted state

## Scope
- Add a v2 event log fixture that includes settlement events:
  - `settlement.deposit_required`
  - `settlement.deposit_confirmed`
  - `settlement.executing`
  - plus `cycle.state_changed`, `intent.reserved/unreserved`, `receipt.created`
- Add a checkpoint fixture (`fixtures/events/checkpoint.v1.json`).
- Implement `scripts/replay-events-v2.mjs` that:
  - validates envelope + payload schemas for all events
  - de-dupes by `event_id`
  - replays full log into a reconstructed state summary
  - replays *incrementally* from the checkpoint snapshot + asserts final state matches full replay

## Acceptance criteria
- `npm run verify:m12` exits 0.
- `node verify/runner.ts milestones/M12.yaml` exits 0.

## Required artifacts
Fixtures:
- `fixtures/events/event_log.v2.ndjson`
- `fixtures/events/checkpoint.v1.json`
- `fixtures/events/replay_expected_v2.json`

Proof artifacts:
- `artifacts/milestones/M12/latest/replay_output.json`
- `artifacts/milestones/M12/latest/events_validation.json`
- `artifacts/milestones/M12/latest/assertions.json`
- `artifacts/milestones/M12/latest/commands.log`
