# M55 â€” Partner-program/commercial scaffold for vault reconciliation export rollout (fixtures-first)

## Objective
Add a deterministic partner-program/commercial control layer for vault reconciliation exports so rollout can be gated by plan entitlement and daily export quotas.

## Scope

### 1) Partner-program enforcement (opt-in)
For `settlement.vault_reconciliation.export`, when `SETTLEMENT_VAULT_EXPORT_PARTNER_PROGRAM_ENFORCE=1`:
- require partner enrollment record,
- require feature entitlement `vault_reconciliation_export=true`,
- enforce optional per-day export quota (`vault_reconciliation_export_daily`).

Deterministic failure reason codes:
- `partner_program_missing`
- `partner_feature_not_enabled`
- `partner_quota_exceeded`

### 2) Usage accounting
Track daily usage in state keyed by partner + day + feature:
- increment only on successful export responses,
- preserve deterministic behavior from `query.now_iso`.

### 3) Export response enrichment
When partner-program enforcement is active and export succeeds, include:
- `partner_program.partner_id`
- `partner_program.plan_id`
- `partner_program.feature`
- `partner_program.quota_day`
- `partner_program.daily_limit` (nullable for unlimited)
- `partner_program.daily_used`

### 4) Store scaffolding
Persist partner-program state in store:
- `partner_program`
- `partner_program_usage`

### 5) Fixtures-first verifier
Scenario proves:
- starter plan exports succeed until quota is reached,
- post-quota export is denied deterministically,
- feature-disabled plan is denied,
- pro/unlimited plan succeeds,
- missing enrollment is denied,
- signed payload verification remains valid.

## Acceptance criteria
- `npm run verify:m55` exits 0.
- `node verify/runner.mjs milestones/M55.yaml` returns `overall=true`.
- artifacts exist under `artifacts/milestones/M55/latest/*`.
