# M103 — Liquidity provider primitives + attribution contracts (implemented, fixtures-first)

## Objective
Introduce canonical liquidity-provider primitives so house bots and partner LPs are first-class, transparent participants in SwapGraph contracts without breaking existing auth and actor semantics.

## Scope
### A) Canonical objects (implemented)
1. `LiquidityProviderRef`
   - provider identity (`provider_id`, `provider_type`, `owner_actor`)
   - disclosure posture (`is_automated`, `is_house_inventory`, `label_required`, `display_label`, `disclosure_text`)
   - optional policy/persona linkage (`policy_ref`, `persona_ref`)
2. `BotPersonaRef`
   - `provider_id`, `persona_id`, `display_name`, `strategy_summary`, `disclosure_text`, `active`, `updated_at`
3. `LiquidityPolicyRef`
   - `policy_id`, `policy_version`, `policy_mode`, `constraints_hash`

### B) Attribution contract additions (implemented)
- `SwapIntent` supports optional `liquidity_provider_ref`, `persona_ref`, and `liquidity_policy_ref`.
- `CycleProposal.participants[]` supports optional LP attribution refs.
- `SwapReceipt` supports optional `liquidity_provider_summary[]` disclosure lineage.

### C) LP registry APIs (implemented)
1. `liquidityProviders.register` → `POST /liquidity-providers`
2. `liquidityProviders.get` → `GET /liquidity-providers/{provider_id}`
3. `liquidityProviders.list` → `GET /liquidity-providers`
4. `liquidityProviders.persona.upsert` → `POST /liquidity-providers/{provider_id}/persona`

## Contract map (approved and implemented)
| Operation ID | Method/Path | Idempotency | Actors | Scopes | Notes |
|---|---|---:|---|---|---|
| `liquidityProviders.register` | `POST /liquidity-providers` | yes | `partner` | `settlement:write` | register provider profile with disclosure and optional policy ref |
| `liquidityProviders.get` | `GET /liquidity-providers/{provider_id}` | no | `partner` | `settlement:read` | owner-scoped provider read |
| `liquidityProviders.list` | `GET /liquidity-providers` | no | `partner` | `settlement:read` | owner-scoped provider list (optional `provider_type` filter) |
| `liquidityProviders.persona.upsert` | `POST /liquidity-providers/{provider_id}/persona` | yes | `partner` | `settlement:write` | upsert disclosure/persona profile for provider |

## Implemented schema artifacts
- `LiquidityProviderRef.schema.json`
- `BotPersonaRef.schema.json`
- `LiquidityPolicyRef.schema.json`
- `LiquidityProviderRegisterRequest.schema.json`
- `LiquidityProviderRegisterResponse.schema.json`
- `LiquidityProviderGetResponse.schema.json`
- `LiquidityProviderListResponse.schema.json`
- `LiquidityProviderPersonaUpsertRequest.schema.json`
- `LiquidityProviderPersonaUpsertResponse.schema.json`
- `LiquidityProviderRegisteredPayload.schema.json`
- `LiquidityProviderPersonaUpsertedPayload.schema.json`

## Deterministic reason-code floor (implemented)
- `liquidity_provider_invalid`
- `liquidity_provider_not_found`
- `liquidity_provider_type_invalid`
- `liquidity_provider_actor_mismatch`
- `liquidity_provider_persona_invalid`
- `liquidity_provider_disclosure_required`

## Non-goals (M103)
- No autonomous trading behavior implementation.
- No settlement-mode automation changes.
- No UI implementation.

## Acceptance (implementation stage)
- `npm run verify:m103` exits 0.
- `node verify/runner.mjs milestones/M103.yaml` returns `overall=true`.
- Artifacts under `artifacts/milestones/M103/latest/*`.
