# M103 — Liquidity provider primitives + attribution contracts (PRD-only, implementation-ready)

## Objective
Introduce canonical liquidity-provider primitives so house bots and partner LPs are first-class, transparent participants in SwapGraph contracts without breaking existing auth and actor semantics.

## Why this is required (integration findings)
- `ActorRef` currently allows only `user|partner|agent`.
- `SwapIntent`, `CycleProposal`, `SwapReceipt` schemas are strict (`additionalProperties:false`) and have no LP attribution fields.
- Auth validation currently enforces fixed actor-type and scope families.

Therefore LP identity must initially be represented as a contract object linked to current actors, not as an implicit/hidden identity hack.

## Scope
### A) New canonical objects (to define)
1. `LiquidityProviderRef`
   - `provider_id`
   - `provider_type` (`user`, `house_bot`, `partner_lp`)
   - `owner_actor` (`ActorRef`)
   - disclosure flags (`is_automated`, `is_house_inventory`, `label_required`)
2. `BotPersonaRef`
   - `persona_id`, `display_name`, `strategy_summary`, `disclosure_text`, `active`
3. `LiquidityPolicyRef`
   - `policy_id`, `policy_version`, `policy_mode`, `constraints_hash`

### B) Contract surface additions (to define)
- SwapIntent adds optional `liquidity_provider_ref` and `persona_ref`.
- CycleProposal participant projection adds optional LP attribution block.
- SwapReceipt adds optional LP attribution summary for counterparties.
- Receipt/event projections must preserve disclosure lineage.

### C) LP registry APIs (to define)
1. `liquidityProviders.register` → `POST /liquidity-providers`
2. `liquidityProviders.get` → `GET /liquidity-providers/{provider_id}`
3. `liquidityProviders.list` → `GET /liquidity-providers`
4. `liquidityProviders.persona.upsert` → `POST /liquidity-providers/{provider_id}/persona`

## Proposed auth/scope model
- Reuse existing scope families initially:
  - writes: `settlement:write`
  - reads: `settlement:read`
- Allowed actors: `partner` (house/partner LP admin operations), optional `user` for self-declared LP profile in later tranche.

## Proposed schema artifacts (naming target)
- `LiquidityProviderRef.schema.json`
- `BotPersonaRef.schema.json`
- `LiquidityPolicyRef.schema.json`
- `LiquidityProviderRegisterRequest.schema.json`
- `LiquidityProviderRegisterResponse.schema.json`
- `LiquidityProviderGetResponse.schema.json`
- `LiquidityProviderListResponse.schema.json`
- `LiquidityProviderPersonaUpsertRequest.schema.json`
- `LiquidityProviderPersonaUpsertResponse.schema.json`

## Deterministic reason-code floor (proposed)
- `liquidity_provider_invalid`
- `liquidity_provider_not_found`
- `liquidity_provider_type_invalid`
- `liquidity_provider_actor_mismatch`
- `liquidity_provider_persona_invalid`
- `liquidity_provider_disclosure_required`

## Non-goals (M103)
- No autonomous trading behavior implementation.
- No settlement-mode automation changes.
- No UI implementation; only contract payload definitions.

## Acceptance (PRD stage)
M103 is accepted when:
1. LP primitives are canonical and non-overlapping,
2. intent/proposal/receipt attribution contract boundaries are explicit,
3. registry APIs and auth model are fixed,
4. deterministic reason-code floor is approved.

## Acceptance (future implementation stage)
- `npm run verify:m103` exits 0.
- `node verify/runner.ts milestones/M103.yaml` returns `overall=true`.
- Artifacts under `artifacts/milestones/M103/latest/*`.
