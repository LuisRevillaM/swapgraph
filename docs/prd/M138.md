# M138 â€” TS-shadow execution helper extraction parity gate (non-breaking)

## Objective
Extract TS-shadow execution/persistence utilities from `marketplaceMatchingService` into dedicated modules and enforce JS/TS parity with deterministic extraction verification.

## Scope
- Add extracted JS helper module:
  - `src/service/marketplaceMatchingTsShadowExecutionHelpers.mjs`
- Add concrete TS parity helper module:
  - `src-ts/service/marketplaceMatchingTsShadowExecutionHelpers.mts`
- Rewire service to import TS-shadow execution helper:
  - `src/service/marketplaceMatchingService.mjs`
- Add deterministic M138 parity/extraction verifier:
  - `scripts/run-m138-typescript-service-ts-shadow-helper-parity-scenario.mjs`
  - `fixtures/release/m138_scenario.json`
  - `fixtures/release/m138_expected.json`
  - `verify/m138.sh`
  - `milestones/M138.yaml`

## Non-goals (M138)
- No API/schema changes.
- No runtime cutover to TS service execution.
- No matcher algorithm changes.
- No TS-shadow policy semantic changes.

## Acceptance criteria
- `npm run verify:m138` exits 0.
- `npm run verify:m137` exits 0 (composed dependency gate).
- `npm run verify:m125` exits 0 (TS-shadow runtime behavior dependency gate).
- Verifier proves:
  - TS TS-shadow helper module is concrete (no export-star wrapper).
  - JS/TS helper export surfaces match expected function set.
  - normalized parity hash matches between JS and TS TS-shadow helper modules.
  - extracted TS-shadow helper function is imported into service.

## Required artifacts
- `docs/prd/M138.md`
- `src/service/marketplaceMatchingTsShadowExecutionHelpers.mjs`
- `src-ts/service/marketplaceMatchingTsShadowExecutionHelpers.mts`
- `src/service/marketplaceMatchingService.mjs`
- `scripts/run-m138-typescript-service-ts-shadow-helper-parity-scenario.mjs`
- `fixtures/release/m138_scenario.json`
- `fixtures/release/m138_expected.json`
- `verify/m138.sh`
- `milestones/M138.yaml`
- `artifacts/milestones/M138/latest/typescript_service_ts_shadow_helper_parity_output.json`
- `artifacts/milestones/M138/latest/assertions.json`
- `artifacts/milestones/M138/latest/commands.log`
