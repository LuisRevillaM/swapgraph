# M28 â€” Verifiable receipt signatures (Ed25519) + key publication contract

## Objective
Make `SwapReceipt.signature` **real and verifiable**, not a placeholder.

This closes a trust-critical gap:
- receipts are the canonical proof of completion/unwind
- partners must be able to verify receipts **offline** using published signing keys

Because we are still **fixtures-first** (no HTTP server yet), we implement:
1) deterministic Ed25519 signing for receipts produced by the settlement simulator
2) an offline verifier that proves signatures validate and tampering fails
3) an explicit **key publication contract** (schema + example) for receipt signing keys

## Scope
### 1) Deterministic signing (fixtures-first)
- Add a dev signing keypair under `fixtures/keys/` (non-production).
- Add a signing/verification utility:
  - `src/crypto/receiptSigning.mjs`
  - message = canonical JSON of the receipt **excluding** the `signature` field
  - algorithm: Ed25519
- Update `src/settlement/settlementService.mjs` to sign receipts it creates.

### 2) Contract updates (examples must be valid)
Replace placeholder `sig` strings with actual verifiable signatures in:
- settlement fixtures that snapshot receipts:
  - `fixtures/settlement/m9_expected.json`
  - `fixtures/settlement/m13_expected.json`
- event log fixtures containing `receipt.created` payload receipts:
  - `fixtures/events/event_log.v1.ndjson`
  - `fixtures/events/event_log.v2.ndjson`
- receipt examples:
  - `docs/spec/examples/SwapReceipt.example.json`
  - API examples that embed receipts

### 3) Key publication contract (API-first)
Add a read-only endpoint contract that partners can use to fetch receipt signing keys:
- `GET /keys/receipt-signing`
- Response schema: `ReceiptSigningKeysGetResponse`
- Include an example response under `docs/spec/examples/api/`.

### 4) Verification (proof-gated)
Add a verifier that:
- validates schemas + API examples
- generates receipts via settlement scenarios
- verifies every receipt signature found in:
  - settlement outputs (M9 + M13)
  - event logs v1/v2
  - receipt examples
- proves a tampered receipt fails verification

## Acceptance criteria
- `npm run verify:m28` exits 0.
- `node verify/runner.mjs milestones/M28.yaml` exits 0.

## Required artifacts
- PRD + contract + verifier + proof artifacts under `artifacts/milestones/M28/latest/*`.
