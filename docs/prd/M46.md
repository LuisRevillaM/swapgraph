# M46 â€” Proof-of-custody primitives (Merkle snapshot + inclusion proof verifier)

## Objective
Start the vault/proof-of-custody macro track with deterministic, fixtures-first custody proof primitives:
1) canonical custody snapshot construction,
2) Merkle root derivation,
3) inclusion proof generation and verification.

## Scope

### 1) Custody proof primitives (fixtures-first)
Add a custody proof module that can:
- normalize custody holdings deterministically,
- compute holding keys and leaf hashes,
- build Merkle trees (odd-leaf duplication rule),
- publish snapshot summary (`leaf_count`, `root_hash`),
- generate inclusion proofs,
- verify inclusion proofs.

### 2) Primitive schemas/examples
Add schemas + examples for:
- `CustodyHolding`
- `CustodySnapshot`
- `CustodyInclusionProof`

### 3) Deterministic proof scenario
Scenario validates:
- valid inclusion proofs for selected holdings,
- unknown holding proof generation fails deterministically,
- tampered sibling hash fails (`root_mismatch`),
- tampered holding payload fails (`leaf_hash_mismatch`),
- invalid sibling position fails (`invalid_sibling_position`).

## Acceptance criteria
- `npm run verify:m46` exits 0.
- `node verify/runner.mjs milestones/M46.yaml` returns `overall=true`.
- proof artifacts written under `artifacts/milestones/M46/latest/*`.
