# M23 — Settlement failure path via API service (deposit-timeout unwind + scoped receipt)

## Objective
Prove the **failure path** for settlement when deposit window expires with missing deposits:
- timeline transitions to `failed`
- deposited legs are refunded
- a `failed` receipt is created with transparency `reason_code: "deposit_timeout"`
- reservations are released

All actions are **store-backed and scoped**:
- settlement start is M21 (proposal store + proposal partner scoping)
- failure action is exposed via `SettlementActionsService.expireDepositWindow` and requires owning partner (`tenancy.cycles[cycle_id].partner_id`)

## Inputs
- Proposals seeded into `store.state.proposals` from `fixtures/matching/m5_expected.json`.
- Proposal partner scoping seeded into `store.state.tenancy.proposals`.
- Commit acceptance uses M20’s store-backed commit API.

## Rules (v1)
- Only the owning `partner` may expire the deposit window.
- Wrong partner is `FORBIDDEN`.
- Non-partner actors are `FORBIDDEN`.

## Scope
- Extend `SettlementActionsService` to support `expireDepositWindow` (partner-scoped).
- Add a fixtures scenario that:
  - settles a 2-party cycle into `escrow.pending`,
  - confirms deposit for only one participant,
  - expires the deposit window after deadline,
  - proves the receipt + state + reservation release.

## Acceptance criteria
- `npm run verify:m23` exits 0.
- `node verify/runner.ts milestones/M23.yaml` exits 0.

## Required artifacts
- `docs/prd/M23.md`
- `fixtures/settlement/m23_scenario.json`
- `fixtures/settlement/m23_expected.json`
- `src/service/settlementActionsService.mjs`
- `scripts/run-m23-settlement-failure-from-store-scenario.mjs`
- Proof outputs under `artifacts/milestones/M23/latest/*`
