# M45 â€” Export checkpoint retention + expiry hardening

## Objective
Prevent stale checkpoint anchors from being reused indefinitely by adding deterministic checkpoint retention and expiry enforcement for paginated delegated policy-audit exports.

## Scope

### 1) Checkpoint retention window
- Add `POLICY_AUDIT_EXPORT_CHECKPOINT_RETENTION_DAYS` (defaults to policy-audit retention days when unset).
- Checkpoints older than retention are expired.

### 2) Continuation expiry enforcement
When continuation is requested (`cursor_after` + `checkpoint_after`) and checkpoint mode is enabled:
- if checkpoint is expired, reject with:
  - code: `CONSTRAINT_VIOLATION`
  - `details.reason_code = checkpoint_expired`
- include machine-readable details:
  - `checkpoint_after`, `exported_at`, `now_iso`, `retention_days`.

### 3) Checkpoint garbage collection
- Persisted checkpoint map is pruned opportunistically on export calls.
- Expired checkpoint records are removed so state stays bounded and deterministic.

### 4) Fixtures-first verifier
Scenario proves:
- initial old export pages are valid,
- old continuation fails after retention window with `checkpoint_expired`,
- fresh checkpoints can be issued/continued afterward,
- old checkpoint hashes are absent while fresh hashes remain in store,
- tampered checkpoint still fails offline verification.

## Acceptance criteria
- `npm run verify:m45` exits 0.
- `node verify/runner.mjs milestones/M45.yaml` returns `overall=true`.
- artifacts exist in `artifacts/milestones/M45/latest/*`.
