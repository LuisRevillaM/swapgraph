{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://swapgraph.dev/schemas/SettlementTimeline.schema.json",
  "title": "SettlementTimeline",
  "type": "object",
  "additionalProperties": false,
  "required": ["cycle_id", "state", "legs", "updated_at"],
  "properties": {
    "cycle_id": { "type": "string", "minLength": 1 },
    "state": {
      "type": "string",
      "enum": [
        "proposed",
        "accepted",
        "escrow.pending",
        "escrow.ready",
        "executing",
        "completed",
        "failed"
      ]
    },
    "legs": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "leg_id",
          "intent_id",
          "from_actor",
          "to_actor",
          "assets",
          "status",
          "deposit_deadline_at"
        ],
        "properties": {
          "leg_id": { "type": "string", "minLength": 1 },
          "intent_id": { "type": "string", "minLength": 1 },
          "from_actor": { "$ref": "ActorRef.schema.json" },
          "to_actor": { "$ref": "ActorRef.schema.json" },
          "assets": { "type": "array", "minItems": 1, "items": { "$ref": "AssetRef.schema.json" } },
          "status": { "type": "string", "enum": ["pending", "deposited", "released", "refunded"] },

          "deposit_deadline_at": { "type": "string", "format": "date-time" },
          "deposit_ref": { "type": "string" },
          "deposited_at": { "type": "string", "format": "date-time" },

          "release_ref": { "type": "string" },
          "released_at": { "type": "string", "format": "date-time" },

          "refund_ref": { "type": "string" },
          "refunded_at": { "type": "string", "format": "date-time" }
        }
      }
    },
    "updated_at": { "type": "string", "format": "date-time" }
  }
}
