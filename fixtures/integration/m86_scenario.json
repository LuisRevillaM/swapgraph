{
  "actors": {
    "admin_partner": {
      "type": "partner",
      "id": "ops-admin"
    }
  },
  "operations": [
    {
      "op": "adapter.steam_tier1.contract.upsert",
      "actor_ref": "admin_partner",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "idempotency_key": "m86_contract_v1",
      "request": {
        "contract": {
          "adapter_version": "steam-tier1.vault.v1",
          "steam_app_id": 730,
          "transfer_primitive": "vault_escrow",
          "escrow_mode": "escrow_agent",
          "settlement_modes": [
            "deposit_per_swap",
            "vault_escrow",
            "hybrid"
          ],
          "capability_flags": [
            "inventory_snapshot",
            "vault_binding"
          ],
          "supported_regions": [
            "EU",
            "NA"
          ],
          "max_batch_size": 6,
          "requires_trade_hold": true,
          "requires_mobile_guard": true,
          "dry_run_only": false,
          "notes": "m86 vault live proof contract"
        },
        "occurred_at": "2026-02-20T08:00:00Z"
      },
      "expect_ok": true,
      "expect_version": 1,
      "expect_transfer_primitive": "vault_escrow",
      "expect_max_batch_size": 6,
      "expect_dry_run_only": false,
      "expect_settlement_modes_count": 3,
      "expect_replayed": false
    },
    {
      "op": "adapter.steam_tier1.preflight",
      "actor_ref": "admin_partner",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "idempotency_key": "m86_preflight_1",
      "request": {
        "cycle_id": "cycle_m86_001",
        "settlement_mode": "vault_escrow",
        "asset_count": 2,
        "dry_run": false,
        "requested_at": "2026-02-20T08:05:00Z"
      },
      "expect_ok": true,
      "expect_preflight_id": "steam_preflight_000001",
      "expect_contract_version": 1,
      "expect_ready": true,
      "expect_preflight_reason_code": null,
      "expect_replayed": false
    },
    {
      "op": "adapter.steam_tier1.live_proof.vault.record",
      "actor_ref": "admin_partner",
      "auth": {
        "scopes": [
          "settlement:write",
          "vault:write"
        ]
      },
      "integration_enabled_override": "0",
      "idempotency_key": "m86_live_disabled",
      "request": {
        "cycle_id": "cycle_m86_001",
        "settlement_id": "settlement_m86_001",
        "preflight_id": "steam_preflight_000001",
        "receipt_id": "rcpt_m86_001",
        "vault_holding_ids": [
          "holding_m86_001",
          "holding_m86_002"
        ],
        "vault_reservation_ids": [
          "res_m86_001",
          "res_m86_002"
        ],
        "vault_settlement_mode": "vault_escrow",
        "lifecycle_events": [
          "deposit",
          "reserve",
          "release",
          "withdraw"
        ],
        "instant_ready": true,
        "live_mode": true,
        "operator_ref": "ops-admin",
        "evidence_refs": [
          "https://staging.swapgraph.dev/evidence/m86/vault-holding-m86-001",
          "https://staging.swapgraph.dev/evidence/m86/receipt-rcpt_m86_001"
        ],
        "notes": "integration gate off attempt",
        "occurred_at": "2026-02-20T08:10:00Z"
      },
      "expect_ok": false,
      "expect_error_code": "CONFLICT",
      "expect_reason_code": "steam_live_proof_integration_disabled"
    },
    {
      "op": "adapter.steam_tier1.live_proof.vault.record",
      "actor_ref": "admin_partner",
      "auth": {
        "scopes": [
          "settlement:write",
          "vault:write"
        ]
      },
      "idempotency_key": "m86_live_lifecycle_incomplete",
      "request": {
        "cycle_id": "cycle_m86_001",
        "settlement_id": "settlement_m86_001",
        "preflight_id": "steam_preflight_000001",
        "receipt_id": "rcpt_m86_001",
        "vault_holding_ids": [
          "holding_m86_001",
          "holding_m86_002"
        ],
        "vault_reservation_ids": [
          "res_m86_001",
          "res_m86_002"
        ],
        "vault_settlement_mode": "vault_escrow",
        "lifecycle_events": [
          "deposit",
          "reserve",
          "withdraw"
        ],
        "instant_ready": true,
        "live_mode": true,
        "operator_ref": "ops-admin",
        "evidence_refs": [
          "https://staging.swapgraph.dev/evidence/m86/vault-holding-m86-001"
        ],
        "notes": "missing release lifecycle evidence",
        "occurred_at": "2026-02-20T08:11:00Z"
      },
      "expect_ok": false,
      "expect_error_code": "CONFLICT",
      "expect_reason_code": "steam_live_proof_vault_lifecycle_incomplete"
    },
    {
      "op": "adapter.steam_tier1.live_proof.vault.record",
      "actor_ref": "admin_partner",
      "auth": {
        "scopes": [
          "settlement:write",
          "vault:write"
        ]
      },
      "idempotency_key": "m86_live_1",
      "request": {
        "cycle_id": "cycle_m86_001",
        "settlement_id": "settlement_m86_001",
        "preflight_id": "steam_preflight_000001",
        "receipt_id": "rcpt_m86_001",
        "vault_holding_ids": [
          "holding_m86_001",
          "holding_m86_002"
        ],
        "vault_reservation_ids": [
          "res_m86_001",
          "res_m86_002"
        ],
        "vault_settlement_mode": "vault_escrow",
        "lifecycle_events": [
          "deposit",
          "reserve",
          "release",
          "withdraw"
        ],
        "instant_ready": true,
        "live_mode": true,
        "operator_ref": "ops-admin",
        "evidence_refs": [
          "https://staging.swapgraph.dev/evidence/m86/vault-holding-m86-001",
          "https://staging.swapgraph.dev/evidence/m86/receipt-rcpt_m86_001"
        ],
        "notes": "staging vault live proof capture",
        "occurred_at": "2026-02-20T08:12:00Z"
      },
      "expect_ok": true,
      "expect_proof_id": "steam_live_vault_000001",
      "expect_contract_version": 1,
      "expect_vault_settlement_mode": "vault_escrow",
      "expect_lifecycle_events_count": 4,
      "expect_instant_ready": true,
      "expect_live_mode": true,
      "expect_integration_mode": "live",
      "expect_replayed": false
    },
    {
      "op": "adapter.steam_tier1.live_proof.vault.record",
      "actor_ref": "admin_partner",
      "auth": {
        "scopes": [
          "settlement:write",
          "vault:write"
        ]
      },
      "idempotency_key": "m86_live_1",
      "request": {
        "cycle_id": "cycle_m86_001",
        "settlement_id": "settlement_m86_001",
        "preflight_id": "steam_preflight_000001",
        "receipt_id": "rcpt_m86_001",
        "vault_holding_ids": [
          "holding_m86_001",
          "holding_m86_002"
        ],
        "vault_reservation_ids": [
          "res_m86_001",
          "res_m86_002"
        ],
        "vault_settlement_mode": "vault_escrow",
        "lifecycle_events": [
          "deposit",
          "reserve",
          "release",
          "withdraw"
        ],
        "instant_ready": true,
        "live_mode": true,
        "operator_ref": "ops-admin",
        "evidence_refs": [
          "https://staging.swapgraph.dev/evidence/m86/vault-holding-m86-001",
          "https://staging.swapgraph.dev/evidence/m86/receipt-rcpt_m86_001"
        ],
        "notes": "staging vault live proof capture",
        "occurred_at": "2026-02-20T08:12:00Z"
      },
      "expect_ok": true,
      "expect_proof_id": "steam_live_vault_000001",
      "expect_contract_version": 1,
      "expect_vault_settlement_mode": "vault_escrow",
      "expect_lifecycle_events_count": 4,
      "expect_instant_ready": true,
      "expect_live_mode": true,
      "expect_integration_mode": "live",
      "expect_replayed": true
    },
    {
      "op": "adapter.steam_tier1.live_proof.vault.record",
      "actor_ref": "admin_partner",
      "auth": {
        "scopes": [
          "settlement:write",
          "vault:write"
        ]
      },
      "idempotency_key": "m86_live_1",
      "request": {
        "cycle_id": "cycle_m86_001",
        "settlement_id": "settlement_m86_001",
        "preflight_id": "steam_preflight_000001",
        "receipt_id": "rcpt_m86_001_mutated",
        "vault_holding_ids": [
          "holding_m86_001",
          "holding_m86_002"
        ],
        "vault_reservation_ids": [
          "res_m86_001",
          "res_m86_002"
        ],
        "vault_settlement_mode": "vault_escrow",
        "lifecycle_events": [
          "deposit",
          "reserve",
          "release",
          "withdraw"
        ],
        "instant_ready": true,
        "live_mode": true,
        "operator_ref": "ops-admin",
        "evidence_refs": [
          "https://staging.swapgraph.dev/evidence/m86/vault-holding-m86-001",
          "https://staging.swapgraph.dev/evidence/m86/receipt-rcpt_m86_001_mutated"
        ],
        "notes": "idempotency mismatch",
        "occurred_at": "2026-02-20T08:12:00Z"
      },
      "expect_ok": false,
      "expect_error_code": "IDEMPOTENCY_KEY_REUSE_PAYLOAD_MISMATCH",
      "expect_reason_code": null
    },
    {
      "op": "adapter.steam_tier1.live_proof.vault.record",
      "actor_ref": "admin_partner",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "idempotency_key": "m86_live_scope_fail",
      "request": {
        "cycle_id": "cycle_m86_scope_fail",
        "settlement_id": "settlement_m86_scope_fail",
        "receipt_id": "rcpt_m86_scope_fail",
        "vault_holding_ids": [
          "holding_scope_fail"
        ],
        "vault_reservation_ids": [
          "res_scope_fail"
        ],
        "vault_settlement_mode": "vault_escrow",
        "lifecycle_events": [
          "deposit",
          "reserve",
          "release",
          "withdraw"
        ],
        "instant_ready": false,
        "live_mode": true,
        "operator_ref": "ops-admin",
        "evidence_refs": [
          "https://staging.swapgraph.dev/evidence/m86/scope-fail"
        ],
        "notes": "scope validation",
        "occurred_at": "2026-02-20T08:13:00Z"
      },
      "expect_ok": false,
      "expect_error_code": "INSUFFICIENT_SCOPE",
      "expect_reason_code": null
    },
    {
      "op": "adapter.steam_tier1.contract.upsert",
      "actor_ref": "admin_partner",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "idempotency_key": "m86_contract_v2",
      "request": {
        "contract": {
          "adapter_version": "steam-tier1.vault.v2",
          "steam_app_id": 730,
          "transfer_primitive": "vault_escrow",
          "escrow_mode": "escrow_agent",
          "settlement_modes": [
            "vault_escrow"
          ],
          "capability_flags": [
            "inventory_snapshot",
            "vault_binding"
          ],
          "supported_regions": [
            "EU",
            "NA"
          ],
          "max_batch_size": 6,
          "requires_trade_hold": true,
          "requires_mobile_guard": true,
          "dry_run_only": true,
          "notes": "set dry-run only to block live vault proof"
        },
        "occurred_at": "2026-02-20T08:20:00Z"
      },
      "expect_ok": true,
      "expect_version": 2,
      "expect_transfer_primitive": "vault_escrow",
      "expect_max_batch_size": 6,
      "expect_dry_run_only": true,
      "expect_settlement_modes_count": 1,
      "expect_replayed": false
    },
    {
      "op": "adapter.steam_tier1.live_proof.vault.record",
      "actor_ref": "admin_partner",
      "auth": {
        "scopes": [
          "settlement:write",
          "vault:write"
        ]
      },
      "idempotency_key": "m86_live_blocked_dry_run",
      "request": {
        "cycle_id": "cycle_m86_002",
        "settlement_id": "settlement_m86_002",
        "receipt_id": "rcpt_m86_002",
        "vault_holding_ids": [
          "holding_m86_003"
        ],
        "vault_reservation_ids": [
          "res_m86_003"
        ],
        "vault_settlement_mode": "vault_escrow",
        "lifecycle_events": [
          "deposit",
          "reserve",
          "release",
          "withdraw"
        ],
        "instant_ready": false,
        "live_mode": true,
        "operator_ref": "ops-admin",
        "evidence_refs": [
          "https://staging.swapgraph.dev/evidence/m86/vault-holding-m86-003"
        ],
        "notes": "blocked by dry-run-only contract",
        "occurred_at": "2026-02-20T08:21:00Z"
      },
      "expect_ok": false,
      "expect_error_code": "CONFLICT",
      "expect_reason_code": "steam_live_proof_contract_unsupported_mode"
    },
    {
      "op": "adapter.steam_tier1.contract.get",
      "actor_ref": "admin_partner",
      "auth": {
        "scopes": [
          "settlement:read"
        ]
      },
      "query": {
        "now_iso": "2026-02-20T08:22:00Z"
      },
      "expect_ok": true,
      "expect_contract_version": 2,
      "expect_contract_transfer_primitive": "vault_escrow",
      "expect_contract_max_batch_size": 6,
      "expect_contract_dry_run_only": true,
      "expect_preflight_total_preflight_requests": 1,
      "expect_preflight_ready_count": 1,
      "expect_preflight_blocked_count": 0,
      "expect_integration_mode": "fixture_only"
    }
  ]
}
