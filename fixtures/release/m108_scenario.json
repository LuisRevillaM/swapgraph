{
  "actors": {
    "partner_alpha": {
      "type": "partner",
      "id": "partner_alpha"
    }
  },
  "seed_state": {
    "liquidity_providers": {
      "lp_house_alpha": {
        "provider_id": "lp_house_alpha",
        "provider_type": "house_bot",
        "owner_actor": {
          "type": "partner",
          "id": "partner_alpha"
        },
        "is_automated": true,
        "is_house_inventory": true,
        "label_required": true,
        "display_label": "Alpha Market Maker",
        "disclosure_text": "Automated house-liquidity participant.",
        "active": true,
        "policy_ref": {
          "policy_id": "lp_policy_alpha",
          "policy_version": 3,
          "policy_mode": "constrained_auto",
          "constraints_hash": "sha256:lp-policy-alpha-v3"
        },
        "created_at": "2026-02-22T13:50:00Z",
        "updated_at": "2026-02-22T13:50:00Z"
      }
    }
  },
  "operations": [
    {
      "op": "liquidityPolicy.get",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:read"
        ]
      },
      "provider_id": "lp_house_alpha",
      "save_provider_ref": "provider_alpha",
      "expect_ok": true,
      "expect_provider_id": "lp_house_alpha",
      "expect_policy_id": "lp_policy_alpha",
      "expect_policy_version": 3,
      "expect_policy_mode": "constrained_auto",
      "expect_high_volatility_mode": "tighten",
      "expect_max_spread_bps": 500
    },
    {
      "op": "liquidityPolicy.upsert",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "idempotency_key": "m108_policy_invalid_1",
      "skip_request_validation": true,
      "request": {
        "policy": {
          "policy_id": "lp_policy_alpha",
          "max_spread_bps": 300
        },
        "recorded_at": "2026-02-22T14:00:00Z"
      },
      "expect_ok": false,
      "expect_error_code": "CONSTRAINT_VIOLATION",
      "expect_reason_code": "liquidity_policy_invalid"
    },
    {
      "op": "liquidityPolicy.upsert",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "idempotency_key": "m108_policy_precedence_invalid_1",
      "request": {
        "policy": {
          "policy_id": "lp_policy_alpha",
          "policy_mode": "constrained_auto",
          "precedence_assertion": "safety>trust>commercial>preference",
          "max_spread_bps": 300,
          "max_daily_value_usd": 10000,
          "max_counterparty_exposure_usd": 4000,
          "min_price_confidence_bps": 7500,
          "blocked_asset_liquidity_tiers": [
            "critical"
          ],
          "high_volatility_mode": "quote_only"
        },
        "recorded_at": "2026-02-22T14:00:00Z"
      },
      "expect_ok": false,
      "expect_error_code": "CONSTRAINT_VIOLATION",
      "expect_reason_code": "liquidity_policy_precedence_violation"
    },
    {
      "op": "liquidityPolicy.upsert",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "idempotency_key": "m108_policy_upsert_1",
      "request": {
        "policy": {
          "policy_id": "lp_policy_alpha",
          "policy_mode": "constrained_auto",
          "precedence_assertion": "safety>trust>lp_autonomy_policy>commercial>preference",
          "max_spread_bps": 300,
          "max_daily_value_usd": 10000,
          "max_counterparty_exposure_usd": 4000,
          "min_price_confidence_bps": 7500,
          "blocked_asset_liquidity_tiers": [
            "critical"
          ],
          "high_volatility_mode": "quote_only"
        },
        "recorded_at": "2026-02-22T14:05:00Z"
      },
      "expect_ok": true,
      "expect_replayed": false,
      "expect_provider_id": "lp_house_alpha",
      "expect_policy_id": "lp_policy_alpha",
      "expect_policy_version": 4,
      "expect_policy_mode": "constrained_auto",
      "expect_high_volatility_mode": "quote_only",
      "expect_max_spread_bps": 300
    },
    {
      "op": "liquidityPolicy.upsert",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "idempotency_key": "m108_policy_upsert_1",
      "request": {
        "policy": {
          "policy_id": "lp_policy_alpha",
          "policy_mode": "constrained_auto",
          "precedence_assertion": "safety>trust>lp_autonomy_policy>commercial>preference",
          "max_spread_bps": 300,
          "max_daily_value_usd": 10000,
          "max_counterparty_exposure_usd": 4000,
          "min_price_confidence_bps": 7500,
          "blocked_asset_liquidity_tiers": [
            "critical"
          ],
          "high_volatility_mode": "quote_only"
        },
        "recorded_at": "2026-02-22T14:05:00Z"
      },
      "expect_ok": true,
      "expect_replayed": true,
      "expect_policy_version": 4
    },
    {
      "op": "liquidityPolicy.upsert",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "idempotency_key": "m108_policy_upsert_1",
      "request": {
        "policy": {
          "policy_id": "lp_policy_alpha",
          "policy_mode": "constrained_auto",
          "precedence_assertion": "safety>trust>lp_autonomy_policy>commercial>preference",
          "max_spread_bps": 280,
          "max_daily_value_usd": 10000,
          "max_counterparty_exposure_usd": 4000,
          "min_price_confidence_bps": 7500,
          "blocked_asset_liquidity_tiers": [
            "critical"
          ],
          "high_volatility_mode": "quote_only"
        },
        "recorded_at": "2026-02-22T14:06:00Z"
      },
      "expect_ok": false,
      "expect_error_code": "IDEMPOTENCY_KEY_REUSE_PAYLOAD_MISMATCH"
    },
    {
      "op": "liquidityPolicy.evaluate",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "idempotency_key": "m108_eval_invalid_1",
      "skip_request_validation": true,
      "request": {
        "recorded_at": "2026-02-22T14:08:00Z"
      },
      "expect_ok": false,
      "expect_error_code": "CONSTRAINT_VIOLATION",
      "expect_reason_code": "liquidity_policy_invalid"
    },
    {
      "op": "liquidityPolicy.evaluate",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "idempotency_key": "m108_eval_precedence_invalid_1",
      "request": {
        "evaluation": {
          "operation_id": "liquidityDecisions.proposal.accept",
          "precedence_assertion": "safety>trust>commercial>preference",
          "safety_gate_passed": true,
          "trust_gate_passed": true,
          "commercial_gate_passed": true,
          "action_type": "accept",
          "spread_bps": 180,
          "quote_value_usd": 200,
          "daily_value_usd": 1000,
          "counterparty_actor_id": "user_001",
          "counterparty_exposure_usd": 300,
          "price_confidence_bps": 8200,
          "asset_liquidity_tier": "medium",
          "high_volatility": false
        },
        "recorded_at": "2026-02-22T14:09:00Z"
      },
      "expect_ok": false,
      "expect_error_code": "CONSTRAINT_VIOLATION",
      "expect_reason_code": "liquidity_policy_precedence_violation"
    },
    {
      "op": "liquidityPolicy.evaluate",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "idempotency_key": "m108_eval_allow_1",
      "request": {
        "evaluation": {
          "operation_id": "liquidityDecisions.proposal.accept",
          "precedence_assertion": "safety>trust>lp_autonomy_policy>commercial>preference",
          "safety_gate_passed": true,
          "trust_gate_passed": true,
          "commercial_gate_passed": true,
          "action_type": "quote",
          "spread_bps": 180,
          "quote_value_usd": 200,
          "daily_value_usd": 1000,
          "counterparty_actor_id": "user_001",
          "counterparty_exposure_usd": 300,
          "price_confidence_bps": 8200,
          "asset_liquidity_tier": "medium",
          "high_volatility": false
        },
        "recorded_at": "2026-02-22T14:10:00Z"
      },
      "expect_ok": true,
      "expect_replayed": false,
      "expect_provider_id": "lp_house_alpha",
      "expect_verdict": "allow",
      "expect_reason_codes_count": 0,
      "expect_policy_version": 4,
      "save_audit_ref": "audit_allow_1"
    },
    {
      "op": "liquidityPolicy.evaluate",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "idempotency_key": "m108_eval_spread_1",
      "request": {
        "evaluation": {
          "operation_id": "liquidityDecisions.proposal.accept",
          "precedence_assertion": "safety>trust>lp_autonomy_policy>commercial>preference",
          "safety_gate_passed": true,
          "trust_gate_passed": true,
          "commercial_gate_passed": true,
          "action_type": "accept",
          "spread_bps": 380,
          "quote_value_usd": 200,
          "daily_value_usd": 1200,
          "counterparty_actor_id": "user_001",
          "counterparty_exposure_usd": 500,
          "price_confidence_bps": 8200,
          "asset_liquidity_tier": "medium",
          "high_volatility": false
        },
        "recorded_at": "2026-02-22T14:11:00Z"
      },
      "expect_ok": true,
      "expect_replayed": false,
      "expect_verdict": "deny",
      "expect_reason_codes_count": 1,
      "expect_reason_codes": [
        "liquidity_policy_spread_exceeded"
      ],
      "expect_policy_version": 4
    },
    {
      "op": "liquidityPolicy.evaluate",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "idempotency_key": "m108_eval_exposure_1",
      "request": {
        "evaluation": {
          "operation_id": "liquidityDecisions.proposal.accept",
          "precedence_assertion": "safety>trust>lp_autonomy_policy>commercial>preference",
          "safety_gate_passed": true,
          "trust_gate_passed": true,
          "commercial_gate_passed": true,
          "action_type": "accept",
          "spread_bps": 200,
          "quote_value_usd": 9800,
          "daily_value_usd": 400,
          "counterparty_actor_id": "user_001",
          "counterparty_exposure_usd": 100,
          "price_confidence_bps": 8200,
          "asset_liquidity_tier": "medium",
          "high_volatility": false
        },
        "recorded_at": "2026-02-22T14:12:00Z"
      },
      "expect_ok": true,
      "expect_replayed": false,
      "expect_verdict": "deny",
      "expect_reason_codes_count": 1,
      "expect_reason_codes": [
        "liquidity_policy_exposure_exceeded"
      ],
      "expect_policy_version": 4
    },
    {
      "op": "liquidityPolicy.evaluate",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "idempotency_key": "m108_eval_confidence_1",
      "request": {
        "evaluation": {
          "operation_id": "liquidityDecisions.proposal.accept",
          "precedence_assertion": "safety>trust>lp_autonomy_policy>commercial>preference",
          "safety_gate_passed": true,
          "trust_gate_passed": true,
          "commercial_gate_passed": true,
          "action_type": "accept",
          "spread_bps": 200,
          "quote_value_usd": 200,
          "daily_value_usd": 600,
          "counterparty_actor_id": "user_001",
          "counterparty_exposure_usd": 600,
          "price_confidence_bps": 7000,
          "asset_liquidity_tier": "medium",
          "high_volatility": false
        },
        "recorded_at": "2026-02-22T14:13:00Z"
      },
      "expect_ok": true,
      "expect_replayed": false,
      "expect_verdict": "deny",
      "expect_reason_codes_count": 1,
      "expect_reason_codes": [
        "liquidity_policy_price_confidence_low"
      ],
      "expect_policy_version": 4
    },
    {
      "op": "liquidityPolicy.upsert",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "idempotency_key": "m108_policy_upsert_pause_1",
      "request": {
        "policy": {
          "policy_id": "lp_policy_alpha",
          "policy_mode": "constrained_auto",
          "precedence_assertion": "safety>trust>lp_autonomy_policy>commercial>preference",
          "max_spread_bps": 280,
          "max_daily_value_usd": 10000,
          "max_counterparty_exposure_usd": 4000,
          "min_price_confidence_bps": 7500,
          "blocked_asset_liquidity_tiers": [
            "critical"
          ],
          "high_volatility_mode": "pause"
        },
        "recorded_at": "2026-02-22T14:14:00Z"
      },
      "expect_ok": true,
      "expect_replayed": false,
      "expect_policy_version": 5,
      "expect_high_volatility_mode": "pause",
      "expect_max_spread_bps": 280
    },
    {
      "op": "liquidityPolicy.evaluate",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "idempotency_key": "m108_eval_pause_1",
      "request": {
        "evaluation": {
          "operation_id": "liquidityExecution.request.record",
          "precedence_assertion": "safety>trust>lp_autonomy_policy>commercial>preference",
          "safety_gate_passed": true,
          "trust_gate_passed": true,
          "commercial_gate_passed": true,
          "action_type": "execute",
          "spread_bps": 120,
          "quote_value_usd": 300,
          "daily_value_usd": 700,
          "counterparty_actor_id": "user_001",
          "counterparty_exposure_usd": 700,
          "price_confidence_bps": 8500,
          "asset_liquidity_tier": "medium",
          "high_volatility": true
        },
        "recorded_at": "2026-02-22T14:14:00Z"
      },
      "expect_ok": true,
      "expect_replayed": false,
      "expect_verdict": "deny",
      "expect_reason_codes_count": 1,
      "expect_reason_codes": [
        "liquidity_policy_high_volatility_pause"
      ],
      "expect_policy_version": 5
    },
    {
      "op": "liquidityPolicy.evaluate",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:write"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "idempotency_key": "m108_eval_precedence_deny_1",
      "request": {
        "evaluation": {
          "operation_id": "liquidityDecisions.proposal.accept",
          "precedence_assertion": "safety>trust>lp_autonomy_policy>commercial>preference",
          "safety_gate_passed": true,
          "trust_gate_passed": false,
          "commercial_gate_passed": true,
          "action_type": "accept",
          "spread_bps": 120,
          "quote_value_usd": 200,
          "daily_value_usd": 800,
          "counterparty_actor_id": "user_001",
          "counterparty_exposure_usd": 800,
          "price_confidence_bps": 8500,
          "asset_liquidity_tier": "medium",
          "high_volatility": false
        },
        "recorded_at": "2026-02-22T14:15:00Z"
      },
      "expect_ok": true,
      "expect_replayed": false,
      "expect_verdict": "deny",
      "expect_reason_codes_count": 1,
      "expect_reason_codes": [
        "liquidity_policy_precedence_violation"
      ],
      "expect_policy_version": 5
    },
    {
      "op": "liquidityDecision.audit.list",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:read"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "query": {
        "limit": 2,
        "now_iso": "2026-02-22T15:00:00Z"
      },
      "save_cursor_ref": "audit_cursor_1",
      "expect_ok": true,
      "expect_provider_id": "lp_house_alpha",
      "expect_total_filtered": 6,
      "expect_entries_count": 2,
      "expect_first_audit_id": "lpaudit_000001",
      "expect_next_cursor": "2026-02-22T14:11:00.000Z|lpaudit_000002"
    },
    {
      "op": "liquidityDecision.audit.list",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:read"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "query": {
        "limit": 2,
        "cursor_after": "missing_cursor"
      },
      "expect_ok": false,
      "expect_error_code": "CONSTRAINT_VIOLATION",
      "expect_reason_code": "liquidity_decision_audit_query_invalid"
    },
    {
      "op": "liquidityDecision.audit.list",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:read"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "query": {
        "limit": 2,
        "cursor_after_ref": "audit_cursor_1",
        "now_iso": "2026-02-22T15:00:00Z"
      },
      "save_cursor_ref": "audit_cursor_2",
      "expect_ok": true,
      "expect_total_filtered": 6,
      "expect_entries_count": 2,
      "expect_first_audit_id": "lpaudit_000003",
      "expect_next_cursor": "2026-02-22T14:13:00.000Z|lpaudit_000004"
    },
    {
      "op": "liquidityDecision.audit.list",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:read"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "query": {
        "limit": 1,
        "redact_counterparty": true,
        "now_iso": "2026-02-22T15:00:00Z"
      },
      "expect_ok": true,
      "expect_total_filtered": 6,
      "expect_entries_count": 1,
      "expect_first_audit_id": "lpaudit_000001",
      "expect_first_counterparty_actor_id": "redacted"
    },
    {
      "op": "liquidityDecision.audit.export",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:read"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "query": {
        "limit": 2,
        "now_iso": "2026-02-22T15:00:00Z",
        "exported_at_iso": "2026-02-22T15:00:00Z"
      },
      "save_cursor_ref": "export_cursor_1",
      "save_attestation_ref": "export_att_1",
      "save_checkpoint_ref": "export_chk_1",
      "expect_ok": true,
      "expect_provider_id": "lp_house_alpha",
      "expect_total_filtered": 6,
      "expect_entries_count": 2,
      "expect_first_audit_id": "lpaudit_000001",
      "expect_next_cursor": "2026-02-22T14:11:00.000Z|lpaudit_000002"
    },
    {
      "op": "liquidityDecision.audit.export",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:read"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "query": {
        "limit": 2,
        "cursor_after_ref": "export_cursor_1",
        "attestation_after": "deadbeef",
        "checkpoint_after_ref": "export_chk_1",
        "now_iso": "2026-02-22T15:01:00Z",
        "exported_at_iso": "2026-02-22T15:01:00Z"
      },
      "expect_ok": false,
      "expect_error_code": "CONSTRAINT_VIOLATION",
      "expect_reason_code": "liquidity_decision_audit_query_invalid"
    },
    {
      "op": "liquidityDecision.audit.export",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:read"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "query": {
        "limit": 2,
        "cursor_after_ref": "export_cursor_1",
        "attestation_after_ref": "export_att_1",
        "checkpoint_after_ref": "export_chk_1",
        "now_iso": "2026-02-22T15:02:00Z",
        "exported_at_iso": "2026-02-22T15:02:00Z"
      },
      "save_cursor_ref": "export_cursor_2",
      "save_attestation_ref": "export_att_2",
      "save_checkpoint_ref": "export_chk_2",
      "expect_ok": true,
      "expect_total_filtered": 6,
      "expect_entries_count": 2,
      "expect_first_audit_id": "lpaudit_000003",
      "expect_first_counterparty_actor_id": "user_001",
      "expect_next_cursor": "2026-02-22T14:13:00.000Z|lpaudit_000004"
    },
    {
      "op": "liquidityDecision.audit.export",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:read"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "query": {
        "limit": 2,
        "cursor_after_ref": "export_cursor_2",
        "attestation_after_ref": "export_att_2",
        "checkpoint_after_ref": "export_chk_2",
        "now_iso": "2026-02-22T15:03:00Z",
        "exported_at_iso": "2026-02-22T15:03:00Z"
      },
      "expect_ok": true,
      "expect_total_filtered": 6,
      "expect_entries_count": 2,
      "expect_first_audit_id": "lpaudit_000005",
      "expect_first_counterparty_actor_id": "user_001",
      "expect_next_cursor": null
    },
    {
      "op": "liquidityPolicy.get",
      "actor_ref": "partner_alpha",
      "auth": {
        "scopes": [
          "settlement:read"
        ]
      },
      "provider_id_ref": "provider_alpha",
      "expect_ok": true,
      "expect_policy_version": 5,
      "expect_high_volatility_mode": "pause",
      "expect_max_spread_bps": 280
    }
  ]
}
